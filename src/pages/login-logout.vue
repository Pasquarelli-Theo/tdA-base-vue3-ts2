<script setup lang="ts">
import { ref } from "@vue/reactivity";
import { supabase, user } from "../supabase";
async function signIn(data, node) {
  console.log({ data, node });

  const { user, error } = await /* nvlUtilisateur
    ? supabase.auth.signUp(data)
    : */ supabase.auth.signIn(data);
  console.log({ user, error });

  if (error) {
    console.error(error);
    node.setErrors([error.message]);
  }
}
const nvlUtilisateur = ref(false);
</script>
<template>
  <div>
    <button v-if="user" @pointerdown="supabase.auth.signOut()">
      Se d√©connecter ({{ user.email }})
    </button>
    <FormKit
      v-else
      type="form"
      :submit-label="nvlUtilisateur ? 'S\'inscrire' : 'Se connecter'"
      @submit="signIn"
      :submit-attrs="{ classes: { input: 'bg-blue-500 p-1 rounded' } }"
      :config="{
          classes: {
            input: 'p-1 rounded border-black shadow-sm border',
            label: 'text-gray-600',
          },
        }"
    >
      <FormKit name="email" label="Votre eMail" type="email" />
      <FormKit name="password" label="Mot de passe" type="password" />
      <formKit
        label="Nouvel utilisateur ?"
        name="nvlUtilisateur"
        type="checkbox"
        v-model="nvlUtilisateur"
      />
    </FormKit>
  </div>
</template>
